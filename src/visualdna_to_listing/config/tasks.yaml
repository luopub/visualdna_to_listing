market_intelligence_task:
  description: |
    Start by prompting the user to input a product name with tool user_input_tool.
    Then, ask user to input some key information about the product, such as its price point, target audience, and competitors.
    Conduct an in-depth search for the product on Amazon, Walmart, and relevant tech/lifestyle review blogs. 
    1. Identify the top 3 competitors and their core Unique Selling Propositions (USPs).
    2. Extract at least 10 authentic user scenarios (e.g., "using the lamp at 2 AM for coding").
    3. List the top 5 recurring complaints or anxieties mentioned by buyers.
    4. Observe the visual style of high-performing competitors (lighting, background, angles).
  expected_output: >
    A structured report in markdown format that containing competitor analysis, a prioritized list of customer pain points, and a library of real-world usage scenarios.
  agent: product_research_specialist

resource_kit_generation_task:
  description: |
    Based on the intelligence gathered, populate the 'Product Image Toolkit v3.0' template. You must:
    1. Define 'Scenario Context' based on real user habits (e.g., 'Messy desk' vs 'Minimalist office').
    2. Select 'Visual Mood Keywords' that contrast with competitor weaknesses.
    3. Design at least 3 specific 'Composition Perspectives' that visually debunk the top 5 customer anxieties (e.g., if users fear size issues, suggest a shot with a known reference object like a smartphone).
    4. Specify 'Negative Elements' to avoid based on identified market cliches.
  expected_output: >
    A detailed finalized Product Resource Kit in Markdown format for the specified product category.
  agent: strategic_visual_planner

collect_product_info_task:
  description: |
    1. Read all contents of resource kit file "resource_kit_researched.md" to understand the current product researched context. If it cannot be read all at once, please read it repeatedly in cycles until it is fully read.
    2. Prompt the user to provide the following essential information one at a time:
       - At least one or more product reference photo file paths (absolute paths to actual product photos, one path at a time, empty string for end of input). Remove duplicated paths if exist.
       - Product-specific parameters that differentiate this product from competitors:
         * Size list (e.g., Small/Medium/Large dimensions)
         * Material composition (e.g., 100% cotton canvas, polyester blend)
         * Color variants available
         * Any other product parameters that are helpful to differentiate this product from others.
    3. Refine the resource kit:
       - Add reference photo file paths in a new "Reference Product Photos" section.
       - Remove or revise content that is conflicting with the photo or product parameters provided by the user.
       - Add detailed product parameters in the "Basic Product Facts" section
  expected_output: |
    The refined resource kit updated with all product-specific information from user input in markdown format.
  agent: product_info_collector

reference_photo_description_task:
  description: |
    Get the reference photo file paths from the resource kit. Then, for each photo, generate a description in reference text in less tha 100 words and put the description under the corresponding photo file path in the "Reference Product Photos" section.
    These details must be included:
      - Geometry: Describes the precise contours of the reference image (such as simulate-1.png). For example: "Maintain the square structure with 90-degree right-angle turns in the reference image.".
      - Material Mapping: Lock the 'Raw Materials' section directly to the visual area of the reference image. For example: "The matte frosted texture in the reference image needs to reflect the heaviness of 1000D nylon.".
      - Detail Fingerprinting: It is essential to mention the microscopic features in the reference image, such as the spacing of "double-stitching" or the metallic texture of "large-gauge zipper".
  expected_output: |
    A refined resource kit with all reference photo file paths and descriptions in markdown format.
  agent: product_info_collector

confirm_and_save_facts_task:
  description: |
    Review the update resource kit and extract all facts that may affect the product listing. Then prompt user to confirm them one by one, and take action on user input.
       - If user confirms a fact, keep it in the resource kit. (User input empty string)
       - If user rejects a fact, remove it from the resource kit. (User input "reject" or "r", case-insensitive)
       - If user provides additional information or corrections, update the resource kit accordingly. (User input is the new fact or correction)
  expected_output: |
    The final confirmed resource kit with all facts validated by the user.
  agent: product_info_collector

define_visual_dna_task:
  description: |
    1. Parse the provided resource_kit_refined.md, specifically extracting the "Primary Mood Palette" and "Lighting Specifications".
    2. Identify "Negative Elements to Avoid" (e.g., no white backgrounds, no adult models) to differentiate from competitors.
    3. Define the core visual signature based on the data extracted in step 1.
  expected_output: >
    A Visual DNA Specification document that locks in the lighting, texture requirements, and color palette.
  agent: visual_dna_architect

plan_and_write_prompts_task:
  description: |
    1. Visual DNA Cloning: Develop 10 high-fidelity image generation prompts from refined resource kit and Visual DNA Specification. The core objective is to create a "Digital Twin" of the product shown in the reference photos.
    2. Structural Integrity (MANDATORY): You must treat the reference photos (e.g., `simulate-1.png`) as the **absolute blueprint**. The generated prompts must explicitly describe the product's geometry, silhouette, and component placement (e.g., zipper position, handle shape) to ensure NO extra parts or structural modifications are hallucinated.
    3. Material & Texture Mapping:
      - Link every 'Raw Material' from resource_kit_refined.md directly to a visual feature in a reference photo.
      - Use sensory language to describe textures: "the exact matte finish of the 1000D nylon as seen in [path]", "the heavy-duty metallic sheen of the large-gauge zipper".
    4. Data-Driven Detail: Incorporate 'Basic Product Facts' (e.g., dual-purpose storage, 300L capacity) not just as text, but as visual scale and volume cues.
    5. Contextual Logic:
      - Use the 'Scenario Context' table for background settings.
      - Ensure the background never interferes with the product's structural clarity.
    6. Anxiety-Driven Perspectives: Use "Composition Perspectives" (1-6) to debunk customer fears by showing close-up structural integrity and real-world durability.
    7. Technical Constraints:
      - No additional decorations or components not present in reference photos.
      - All on-image text must be in English.
      - First prompt must be a "Hero Shot" (The Master Product Visual).
    8. Each image generation prompt must follow this strict schema to ensure model compliance:
      - Reference Image Paths: At least one reference photo path (absolute path to the image file from the resource kit).
      - Scene Name: (e.g., The Honest Hero Shot)
      - Primary Reference Path: (e.g., `simulate-1.png`)
      - Structural Anchor: (A one-sentence instruction for the AI to freeze the product's shape, e.g., "Maintain the exact hexagonal silhouette and double-stitched seams from the reference.")
      - The Final Prompt: [A dense, technical prompt string including:
        1. Product Core: Exact replica of one of the reference photos;
        2. Material Specs: <Specific Texture> + <Raw Material>;
        3. Perspective: <Composition Perspective>;
        4. Environment: <Scenario>;
        5. Quality Tags: Photorealistic, industrial design fidelity, NO extra accessories.]
      - Aspect Ratio: 1:1
      - Image Size: 1024x1024 or 1K
  expected_output: |
    A structured list of 10 prompts. 
  agent: creative_prompt_engineer

image_prompts_review_task:
  description: |
    Review the 10 prompts produced in the previous task. Ensure each prompt is well-structured and references at least one reference photo.
    - If a prompt is missing a reference image, load file resource_kit_refined.md to find one or more suitable reference photos.
    If all prompts are well-structured, approve them for image generation without change.
    Do not modify the prompts text.
  expected_output: |
    A list of 10 well-structured prompts. Each prompt must include:
    - Reference Image Paths (One or more, selected from Resource Kit reference photos list)
    - Prompt text for image generation
  agent: creative_prompt_engineer

generate_listing_images_task:
  description: |
    Execute the 10 prompts produced in the previous task. Ensure each target image is named according to the Scene Name with valid filename characters and are numbered sequentially.
    Calling to image generator must match the args_schema defined for the tool, not bare string.
    Reference images must be pass to the generator call as a list of file paths.
  expected_output: >
    10 high-resolution image file names saved locally by generator.
  agent: image_production_specialist